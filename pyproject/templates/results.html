{% extends 'layout.html' %}
{% block content %}
<hr>
<div class="wrapper cont">

<br>
<h2 align="center"><strong>Pageinsights Analysis</strong></h2>
<subscript>{{analyzedurl}}</subscript>
<hr>
<div align="center" class="copytoclipboard">
    <p><input type="text" class="output" id="myInput" style="display: none;">
        <br><button class="btn btn-primary" id="copiedtxt" style="display: none;" onclick="myFunction()">Copy text</button></p>
    <button id="btn" class="btn btn-primary" onclick="document.getElementById('myInput').style.display = 'block' ;" >Share this report </button>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        $('#btn').click(function() {
            currLoc = $(location).attr('href');
            document.getElementById('copiedtxt').style.display = 'block' ;
            document.querySelector('.output').value = currLoc;
            
        });
        function myFunction() {
                /* Get the text field */
                var copyText = document.getElementById("myInput");
                /* Select the text field */
                copyText.select();
                copyText.setSelectionRange(0, 99999); /* For mobile devices */
                /* Copy the text inside the text field */
                navigator.clipboard.writeText(copyText.value);
                /* Alert the copied text */
                alert("Copied the report url: " + copyText.value);
                }
    </script>
</div>
<hr>
<div align="left" style="padding-left: 10%; padding-right: 5%;">
    <!-- base information about the current page -->
    <h4 align="center">Overall Page Performance Score<h2 style="color:green" align="center"> {{lighthouseResult["categories"]["performance"]["score"]*100}}%</h2></h4>
    
    <h5>BASE INFORMATION</h5> 
    <caption>{{analyzedurl}}</caption>
    <br>
    Captcha status :  {{captcha}}
    <br>
    <small>Timestamp      :  {{timestamp}}</small>
    <br>
    <br>
    
    <div>
    <h5 align="center">Areas to be improved</h5>
        {% for key,value in auditsdata.items() %}
            <table style="width:100%">
            {% if value["score"] is not none %}
                {% if value["score"]*100 < 99 and value["score"]*100 > 1 %}
                    <!-- if performance is bad then orange -->
                    {% if value["score"]*100 < 75 and value["score"]*100 > 1 %}
                            <tr>
                                <td><strong>{{key}}<div style="color:rgb(255, 115, 0);">{{value["score"]*100}}%</div></strong></td>
                                <td><a href="#{{key}}">(Click here to learn more about {{key}}.)</a></td>
                            </tr>
                    <!-- else performance is average -->
                    {% else %}
                            <tr>
                                <td><strong>{{key}}<div style="color:rgb(0, 38, 255);">{{value["score"]*100}}%</div></strong></td>
                                <td><a href="#{{key}}">(Click here to learn more about {{key}}.)</a></td>
                            </tr>
                    {%endif %}
                {%endif %}
            {%endif %}
            </table>
        {% endfor %}
    </div>
    
</div>
<hr>

<div align="center" class="lighthouseResultcont">
    <!-- url redirections information -->
    <h5>URL INFORMATION</h5> 
    Initial Url :&nbsp&nbsp&nbsp&nbsp<a href="{{lighthouseResult["requestedUrl"]}}">{{lighthouseResult["requestedUrl"]}}</a>
    <br>
    Final Url :&nbsp&nbsp&nbsp&nbsp<a href="{{lighthouseResult["finalUrl"]}}">{{lighthouseResult["finalUrl"]}}</a>
    <hr>
    <br>    
</div>

<div align="center" class="previewcont">
    <!-- usage of iframe in preview of the analyzed site  -->
    <h5 align="center">Preview (Available only for selected sites)</h5> 
    <iframe src="{{lighthouseResult["finalUrl"]}}" width="100%" height="300" title="preview">
    </iframe>
</div>
<hr>
<!-- iterating through different attributes of metrics in auditsdata -->
<div id="datasets">
        <!-- performance calculation in selected attributes -->
        {% for key,value in auditsdata.items() %}
            <div id="{{key}}" class="attributes">
                <h5 align="center">{{key}} Analysis<br><br> 
                    {% if value["score"] is not none %}
                        {% if value["score"] == 1 %}
                            <small><strong>Performance <br><h4 style="color:green">Good</p></h4></strong></small>
                        {% else %}
                            <small><strong>Performance :  {{value["score"]*100}}%</strong></small> 
                        {%endif %}
                    {%endif %}   
            </h5> 
            <!-- Display screenshots of the analyzed page -->
            {% if value['title']=="Full-page screenshot" : %}
                <div><img src="{{value["details"]["screenshot"]["data"]}}"" width="50%" height="300"></div>
            {% endif %}

            <!-- Display screenshots of the Final page -->
            {% if value['title']=="Final Screenshot" : %}
                <div><img src="{{value["details"]["data"]}}"" width="50%" height="300"></div>
            {% endif %}

            <!-- Display snapshots -->
            {% if value['title']=="Screenshot Thumbnails" : %}
                <div>
                    <img src="{{value["details"]["items"][2]["data"]}}"" width="10%" height="100">
                    <img src="{{value["details"]["items"][3]["data"]}}"" width="10%" height="100">
                    <img src="{{value["details"]["items"][4]["data"]}}"" width="10%" height="100">  
                    <br>  
                </div>
            {% endif %}
            <!-- critical request chains -->
            {% if value['id']=="critical-request-chains" : %}
                <div><h6 align="center">&nbsp {{value["displayValue"]}}</h6></div>
            {% endif %}
            

            <!-- special parameters for network requests -->
            {% if value['id']=="network-requests" : %}
            <div class="attributes" align="center">
                    <table align="center " border=1 style="padding:10px">
                    {% for key,value in value["details"]["items"][0].items() %}
                    
                            <tr><td>{{key}}</td><td> {{value}} </td></tr>
                    {% endfor %}
                            </table>
            </div>
                    
            {% endif %}
            
            
            <!-- special parameters for metrics -->
            {% if value['id']=="metrics" : %}
            <div class="attributes" align="center">
                    <table align="center " border=1 style="padding:10px">
                    {% for key,value in value["details"]["items"][0].items() %}
                    
                            <tr><td>{{key}}</td><td> {{value}} ms</td></tr>
                    {% endfor %}
                            </table>
            </div>
                    
            {% endif %}

            <!-- special parameters for diagnostics -->
            {% if value['id']=="diagnostics" : %}
                <div class="attributes" align="center">
                        <table align="center " border=1 style="padding-left:10px">
                        {% for key,value in value["details"]["items"][0].items() %}
                        
                                <tr><td>{{key}}</td><td> {{value}}</td></tr>
                        {% endfor %}
                        </table>                    
                </div>                        
            {% endif %}

            <br>
            <!-- Display title and description and remarks of the attributes -->
            <h6 align="center">&nbsp&nbsp&nbsp&nbsp <u>{{value["title"]}}</u></h6>
            <br>
            <div align="left" style="padding-left: 10%; padding-right: 5%; ">Description/Remarks : <br><br>{{value["description"]}}</div>
            <br>
            <hr>
            </div>
        {% endfor %}
</div>

{% endblock content %}
